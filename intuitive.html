<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Intuitive Ultra Training Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* CSS from previous version, adapted for local storage simplicity */
        :root {
            --color-primary: #10B981; /* Emerald Green */
            --color-secondary: #059669; /* Darker Green */
            --color-background: #0F172A; /* Slate 900 */
            --color-text: #E5E7EB; /* Gray 200 */
            --color-card: #1E293B; /* Slate 800 */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }
        .container-bg {
            background-color: var(--color-card);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--color-primary);
        }
        .header-bg {
            background: linear-gradient(135deg, var(--color-background), #1E40AF);
            border-bottom: 6px solid var(--color-primary);
        }
        .ring-pulse {
             animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-ring {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }
        
        .priority-tag, .flexible-tag, .strength-tag {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 9999px;
            display: inline-block;
            margin-right: 4px;
            margin-bottom: 4px;
            font-weight: 500;
        }
        .priority-tag { background-color: rgba(79, 70, 229, 0.6); color: #E0E7FF; }
        .flexible-tag { background-color: rgba(4, 120, 87, 0.6); color: #D1FAE5; }
        .strength-tag { background-color: rgba(234, 179, 8, 0.6); color: #FEF3C7; }
        
        /* FIX: Added width: 100% to force each task onto its own line within the flex-wrap parent */
        .task-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            width: 100%; /* Forces stacking for mobile readability */
        }
        .task-checkbox {
            margin-right: 8px;
            min-width: 1rem;
            min-height: 1rem;
            cursor: pointer;
            accent-color: var(--color-primary);
        }
        
        /* Custom Mobile Fix for Calendar Row Wrapping (Retained from v2) */
        .calendar-row-mobile-stack > div {
            width: 100%;
        }
        .calendar-row-mobile-stack {
            grid-template-columns: 1fr; /* Default to single column (stacking) */
        }
        @media (min-width: 768px) {
             /* At medium size and above, switch to three columns */
            .calendar-row-mobile-stack {
                grid-template-columns: repeat(3, minmax(0, 1fr)); 
            }
        }
        
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Header Section -->
    <header class="header-bg text-white p-6 md:p-10 rounded-xl shadow-2xl mb-12">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-2 tracking-tight">The Ultra Intuition Training Guide</h1>
            <p class="text-xl md:text-2xl font-light text-gray-300">8-Week Training: Structured Effort, Dauwalter-Inspired Flexibility.</p>
            <p class="mt-4 text-sm text-gray-400 italic">Target Race: Jan 18th (AAA Race) | Target Start: Nov 18th</p>
        </div>
    </header>

    <main class="max-w-6xl mx-auto space-y-12">
        
        <!-- Section 1: Daily System Check -->
        <section id="system-check" class="container-bg p-6 md:p-8 rounded-xl">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                <span class="mr-3 ring-pulse inline-block p-2 rounded-full bg-yellow-500/10">üß†</span> Daily System Check: Your Internal Coach
            </h2>
            <p class="mb-6 text-gray-300">Embrace the <b>train by feel</b> approach. Every morning, answer these three questions before deciding on your workout intensity.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="p-4 rounded-lg bg-gray-700/50 border-t-4 border-yellow-500">
                    <h3 class="text-xl font-semibold text-yellow-300 mb-2">1. The Physical Scan</h3>
                    <p class="text-sm text-gray-200">Where is the pain/soreness? If it's <b>sharp pain</b>, the answer is <b>rest</b>. If it's <b>fatigue/soreness</b>, a light run might be beneficial.</p>
                </div>
                <div class="p-4 rounded-lg bg-gray-700/50 border-t-4 border-yellow-500">
                    <h3 class="text-xl font-semibold text-yellow-300 mb-2">2. The Mental Scan</h3>
                    <p class="text-sm text-gray-200">Am I burnt out, stressed, or dreading the run? If so, <b>cut the run in half</b> or change it to a fun, low-impact activity.</p>
                </div>
                <div class="p-4 rounded-lg bg-gray-700/50 border-t-4 border-yellow-500">
                    <h3 class="text-xl font-semibold text-yellow-300 mb-2">3. The Hunger Scan</h3>
                    <p class="text-sm text-gray-200">Am I well-fueled and rested? If running on fumes, a hard effort will do more harm. Choose an <b>Easy Run or Rest</b> instead.</p>
                </div>
            </div>
        </section>

        <!-- Section 1.5: Key Workouts Explained -->
        <section id="key-workouts" class="container-bg p-6 md:p-8 rounded-xl">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                <span class="mr-3 text-2xl">‚ö°</span> Key Workouts Explained: Specific Efforts
            </h2>
            <p class="mb-6 text-gray-300">These two workouts are the performance-building pillars of your plan. Treat them as non-negotiable in the week's intention, but <b>always</b> adjust the duration/intensity based on your Daily System Check.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Threshold Run Details -->
                <div class="p-4 rounded-lg bg-gray-700/50 border-t-4 border-indigo-500">
                    <h3 class="text-xl font-semibold text-indigo-300 mb-2">1. The Threshold Run (Sustained Pace)</h3>
                    <p class="text-sm text-gray-200 mb-3">Goal: Improve your ability to sustain a hard effort for long periods without accumulating excessive fatigue. This pace is <b>Comfortably Hard</b> (Zone 3/4).</p>
                    
                    <div class="space-y-3 mt-4">
                        <div class="flex items-center p-2 bg-gray-800 rounded-lg border-l-4 border-indigo-400">
                            <span class="text-lg mr-3">üî•</span>
                            <div>
                                <p class="font-medium text-white text-sm">Intensity Check</p>
                                <p class="text-xs text-gray-300">You can speak <b>3-4 words at a time</b>, but not full sentences.</p>
                            </div>
                        </div>
                        <div class="flex items-center p-2 bg-gray-800 rounded-lg border-l-4 border-indigo-400">
                            <span class="text-lg mr-3">‚è±Ô∏è</span>
                            <div>
                                <p class="font-medium text-white text-sm">Example Structure (90 min)</p>
                                <p class="text-xs text-gray-300">Warmup &rarr; <b>2 x 20 min @ Threshold</b> (5 min recovery) &rarr; Cooldown.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Hill/Vert Focus Details -->
                <div class="p-4 rounded-lg bg-gray-700/50 border-t-4 border-amber-500">
                    <h3 class="text-xl font-semibold text-amber-300 mb-2">2. Hill/Vert Focus (Strength & Power)</h3>
                    <p class="text-sm text-gray-200 mb-3">Goal: Build leg strength and power specific to ultra-running, which translates to efficiency and resilience on climbs.</p>
                    
                    <div class="space-y-3 mt-4">
                        <div class="flex items-center p-2 bg-gray-800 rounded-lg border-l-4 border-amber-400">
                            <span class="text-lg mr-3">üöÄ</span>
                            <div>
                                <p class="font-medium text-white text-sm">Option A: Hill Repeats (Power)</p>
                                <p class="text-xs text-gray-300"><b>6-10x</b> (60-90 sec hard up, walk/jog down recovery).</p>
                            </div>
                        </div>
                        <div class="flex items-center p-2 bg-gray-800 rounded-lg border-l-4 border-amber-400">
                            <span class="text-lg mr-3">üèîÔ∏è</span>
                            <div>
                                <p class="font-medium text-white text-sm">Option B: Long Climb (Endurance)</p>
                                <p class="text-xs text-gray-300"><b>30+ min</b> sustained climb @ RPE 6/10 (steady run/power hike).</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Section 2: 8-Week Training Calendar -->
        <section id="training-calendar" class="container-bg p-6 md:p-8 rounded-xl">
            <h2 class="text-3xl font-bold text-white mb-6 flex items-center">
                <span class="mr-3 text-2xl">üóìÔ∏è</span> 8-Week Core Training Guide
            </h2>
            <p class="mb-6 text-gray-300">This is your structured guide. Let your Daily System Check determine which intensity level to pursue each day within the weekly intention. <b>Remember Pre-Run Activation before every run!</b></p>
            
            <div class="overflow-x-auto">
                <div class="min-w-full grid calendar-grid text-sm">
                    <!-- Table Header -->
                    <div class="grid calendar-row-mobile-stack bg-gray-700/70 font-semibold p-2 rounded-t-lg sticky top-0 z-10">
                        <div class="p-2">Week</div>
                        <div class="p-2">Primary Focus & Effort</div>
                        <div class="p-2">Weekly Intentions (6 Active Days)</div>
                    </div>
                    
                    <!-- Calendar Rows -->
                    <!-- Week 1 -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150">
                        <div class="p-2 font-medium">Nov 18 - Nov 24</div>
                        <div class="p-2 text-yellow-400">Base Consistency (Low-Medium)</div>
                        <div data-week="W1" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W1-L1" class="task-checkbox">
                                <span class="priority-tag">1 Long Run (3-4 hrs easy)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W1-T1" class="task-checkbox">
                                <span class="priority-tag">1 Threshold Run (90 mins)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W1-F1" class="task-checkbox">
                                <span class="flexible-tag">3-4 Fun Runs (20-90 min)</span>
                            </label>
                        </div>
                    </div>
                    <!-- Week 2 -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150">
                        <div class="p-2 font-medium">Nov 25 - Dec 1</div>
                        <div class="p-2 text-green-400">Volume & Strength (Medium)</div>
                        <div data-week="W2" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W2-L1" class="task-checkbox">
                                <span class="priority-tag">‚õ∞Ô∏è 1 Long Run (4-5 hrs)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W2-H1" class="task-checkbox">
                                <span class="priority-tag">‚õ∞Ô∏è 1 Hill/Vert Focus (1-2 hrs)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W2-F1" class="task-checkbox">
                                <span class="flexible-tag">3-4 Fun Runs (20-90 min)</span>
                            </label>
                        </div>
                    </div>
                    <!-- Week 3 (Peak) -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150 bg-gray-900/50">
                        <div class="p-2 font-medium">Dec 2 - Dec 8</div>
                        <div class="p-2 text-red-400 font-bold">High Volume Peak (Medium-High)</div>
                        <div data-week="W3" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W3-L1" class="task-checkbox">
                                <span class="priority-tag">‚õ∞Ô∏è 1 Long Run (5+ hrs or B2B)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W3-T1" class="task-checkbox">
                                <span class="priority-tag">üèÉ 1 Threshold Run (90-120)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W3-F1" class="task-checkbox">
                                <span class="flexible-tag">3-4 Fun Runs (20-90 min)</span>
                            </label>
                        </div>
                    </div>
                    <!-- Week 4 (Pre-Taper) -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150">
                        <div class="p-2 font-medium">Dec 9 - Dec 15</div>
                        <div class="p-2 text-yellow-400">Pre-Race Taper (Low-Medium)</div>
                        <div data-week="W4" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W4-L1" class="task-checkbox">
                                <span class="priority-tag">1 Long Run (3 hrs very easy)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W4-E1" class="task-checkbox">
                                <span class="flexible-tag">2-3 Easy Jogs</span>
                            </label>
                            <p class="mt-2 text-xs text-gray-400">üî™ Volume Cut by 20-30%</p>
                        </div>
                    </div>
                    <!-- Week 5 (Tune-Up Race) -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150">
                        <div class="p-2 font-medium">Dec 16 - Dec 22</div>
                        <div class="p-2 text-blue-400 font-bold">TUNE-UP RACE WEEK</div>
                        <div data-week="W5" class="p-2 weekly-intentions week-list text-xs flex flex-col gap-1">
                            <!-- This week uses flex-col which already forces stacking -->
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W5-M1" class="task-checkbox">
                                <strong>Mon/Tue:</strong> <span class="priority-tag">Short Strides</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W5-W1" class="task-checkbox">
                                <strong>Wed-Fri:</strong> <span class="flexible-tag">Very Easy Jogs (30min)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W5-R1" class="task-checkbox">
                                <strong>Sat:</strong> <span class="priority-tag">TUNE-UP RACE</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W5-R2" class="task-checkbox">
                                <strong>Sun:</strong> <span class="flexible-tag">Full Rest</span>
                            </label>
                        </div>
                    </div>
                    <!-- Week 6 (Recovery) -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150">
                        <div class="p-2 font-medium">Dec 23 - Dec 29</div>
                        <div class="p-2 text-yellow-400">Recovery & Reset (Very Low)</div>
                        <div data-week="W6" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W6-E1" class="task-checkbox">
                                <span class="flexible-tag">3-4 Very Easy Jogs</span>
                            </label>
                            <p class="mt-2 text-xs text-gray-400">üßò Volume Cut by 40-50%. Priority: Sleep.</p>
                        </div>
                    </div>
                    <!-- Week 7 (Rebound) -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150">
                        <div class="p-2 font-medium">Dec 30 - Jan 5</div>
                        <div class="p-2 text-green-400">Final Build/Rebound (Medium)</div>
                        <div data-week="W7" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W7-L1" class="task-checkbox">
                                <span class="priority-tag">üèÉ Last Long Run (3-4 hrs)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W7-T1" class="task-checkbox">
                                <span class="priority-tag">1 Threshold Run (1 hour)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W7-F1" class="task-checkbox">
                                <span class="flexible-tag">3-4 Easy/Fun Runs (20-90 min)</span>
                            </label>
                        </div>
                    </div>
                    <!-- Week 8 (Race Taper) -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150 bg-gray-900/50">
                        <div class="p-2 font-medium">Jan 6 - Jan 12</div>
                        <div class="p-2 text-red-400 font-bold">Taper - Volume Drop (Low)</div>
                        <div data-week="W8" class="p-2 weekly-intentions flex flex-wrap gap-1">
                            <label class="task-item">
                                <input type="checkbox" data-task-id="W8-E1" class="task-checkbox">
                                <span class="flexible-tag">4-5 Very Short Jogs (20-40min)</span>
                            </label>
                            <p class="mt-2 text-xs text-gray-400">üî™ Volume Cut by 60%</p>
                        </div>
                    </div>
                     <!-- Race Week -->
                    <div class="grid calendar-row-mobile-stack border-b border-gray-600/50 p-2 items-start hover:bg-gray-700/50 transition duration-150 bg-blue-900/50">
                        <div class="p-2 font-medium">Jan 13 - Jan 19</div>
                        <div class="p-2 text-white font-bold">RACE WEEK (Jan 18)</div>
                        <div data-week="RW" class="p-2 weekly-intentions week-list text-xs flex flex-col gap-1">
                            <!-- This week uses flex-col which already forces stacking -->
                            <label class="task-item">
                                <input type="checkbox" data-task-id="RW-M1" class="task-checkbox">
                                <strong>Mon/Wed:</strong> <span class="flexible-tag">20-min jog + 4 quick strides</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="RW-T1" class="task-checkbox">
                                <strong>Tue/Thu:</strong> <span class="flexible-tag">Full Rest</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="RW-F1" class="task-checkbox">
                                <strong>Fri:</strong> <span class="flexible-tag">Light Shakeout (15min)</span>
                            </label>
                            <label class="task-item">
                                <input type="checkbox" data-task-id="RW-R1" class="task-checkbox">
                                <strong>Sat:</strong> <span class="priority-tag">AAA RACE!</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3 & 4 (omitted for brevity, assume they are present) -->
        
    </main>

    <footer class="mt-12 text-center text-gray-500 text-sm">
        &copy; Vibe Code with Gemini by Kent | Built with Tailwind CSS
    </footer>

    <!-- LOCAL STORAGE APPLICATION LOGIC -->
    <script>
        // Use a descriptive key for localStorage to avoid conflicts
        const STORAGE_KEY = 'ultraPlanProgress_v3_robust'; 
        let progressData = {}; 

        /**
         * Loads progress from localStorage on page load.
         */
        function loadProgress() {
            try {
                const storedProgress = localStorage.getItem(STORAGE_KEY);
                if (storedProgress) {
                    // Initialize progressData with stored data
                    progressData = JSON.parse(storedProgress); 
                    applyProgressToCheckboxes(progressData);
                }
                setupChecklistListeners();
            } catch (error) {
                // Log the error but continue to allow the page to load
                console.error("Error loading progress from localStorage:", error);
                setupChecklistListeners(); // Still set up listeners even if loading failed
            }
        }

        /**
         * Checks the boxes based on the loaded data.
         * @param {Object} data - The data retrieved from localStorage.
         */
        function applyProgressToCheckboxes(data) {
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                const taskId = checkbox.dataset.taskId;
                // Check the box if the key exists and its value is true
                if (taskId && data[taskId] === true) {
                    checkbox.checked = true;
                } else {
                    checkbox.checked = false;
                }
            });
        }

        /**
         * Sets up event listeners for all checkboxes.
         */
        function setupChecklistListeners() {
            document.querySelectorAll('.task-checkbox').forEach(checkbox => {
                // Remove existing listeners to prevent duplicates
                checkbox.removeEventListener('change', handleCheckboxChange); 
                // Add the new listener
                checkbox.addEventListener('change', handleCheckboxChange);
            });
        }

        /**
         * Handles the change event for a checkbox, updating localStorage.
         */
        function handleCheckboxChange(event) {
            const checkbox = event.target;
            const taskId = checkbox.dataset.taskId;
            const isChecked = checkbox.checked;

            if (!taskId) return;

            // 1. Update in-memory object
            progressData[taskId] = isChecked;

            // 2. Save the entire object back to localStorage
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(progressData));
                console.log(`Task ${taskId} updated. Progress saved locally.`);
            } catch (error) {
                console.error("Error saving progress to localStorage. Storage may be full or blocked.", error);
            }
        }


        // Start the application when the window loads
        window.onload = loadProgress;

    </script>
</body>
</html>
